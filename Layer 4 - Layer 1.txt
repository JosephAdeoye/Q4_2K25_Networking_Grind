Layer 4 - The Transport Layer
    - The transport layer provides transparent transfer of data between hosts and is responsible for end to end error recovery and flow control.
    - Flow control is the process of adjusting the flow of data from the sender to ensure that the receiving host can handle all of it.

# Session Multiplexing
    - Session Multiplexing is the process by which a host is able to support multiple sessions simultaneously and manager the individual traffic streams over a single link.

# Layer 4 Port Numbers  
    - The Layer 4 destination port number is used to identify the upper layer protocol.
    - For example, HTTP uses port 80, SMTP email uses port 25.
    - The sender also adds a source port number to the Layer 4 header.
    - The combination of source and destination port number can be used to track sessions. E.g DST: 80 SRC: 1500

# TCP
    - TCP (Transmission Control Protocol) and UDP (User Datagram Protocol) are the most common Layer 4 protocols. 
    - TCP is connection oriented - once a connection is established, data can be sent bidirectionally over that connection.
    - TCP carries out sequencing to ensure segments are processed in the correct order and none are missing.
    - TCP is reliable - the receiving host sends acknowledgments back to the sender. Lost segments are resent.
    - TCP performs flow control.

# TCP Three-Way Handshake
    - SYN (Synchronize)
    - SYN-ACK (Synchronize - Acknowledgement)
    - ACK (Acknowledgement)

## TCP Header Format  

    The TCP header contains several fields used for reliable, connection-oriented communication.  


### Field Explanations (Brief)
    - **Source Port / Destination Port** → Identify sending and receiving applications.  
    - **Sequence Number** → Tracks the position of data in the stream.  
    - **Acknowledgment Number** → Confirms receipt of data.  
    - **Data Offset** → Size of the TCP header.  
    - **Reserved** → Reserved for future use (set to 0).  
    - **Control Flags** → 6 bits: URG, ACK, PSH, RST, SYN, FIN (used to control connections).  
    - **Window Size** → Flow control; how much data can be sent before requiring acknowledgment.  
    - **Checksum** → Error-checking for header and data.  
    - **Urgent Pointer** → Marks urgent data (used with URG flag).  
    - **Options** → Extra settings (e.g., Maximum Segment Size).  
    - **Data** → The actual payload (application data).  
---
# UDP
    - The User Datagram Protocol sends traffic best effort.
    - UDP is not connection oriented. There is no handshake connection setup between the hosts.
    - UDP does not carry out sequencing to ensure segments are processed in the correct order and none are missing.
    - UDP is not reliable - the receiving host does not send acknowledgments back to the sender.
    - UDP does not perform flow control
    - If error detection and recovery is required it is up to the upper layers to provide it.

## UDP Header Format  

The UDP header is much simpler than TCP, providing basic connectionless communication.  


### Field Explanations (Brief)
- **Source Port / Destination Port** → Identify sending and receiving applications.  
- **Length** → Total length of the UDP header and data (in bytes).  
- **Checksum** → Error-checking for header and data (optional in IPv4, mandatory in IPv6).  
- **Data** → The actual payload (application data).  

---

- **TCP** → Complex, reliable, connection-oriented, with sequencing/acknowledgments.  
- **UDP** → Simple, fast, connectionless, with minimal overhead.  

# TCP vs UDP
    - Application developers will typically choose to use TCP for traffic which requires reliability.
    - Real-time applications such as voice and video can't afford the extra overhead of TCP so they can use UDP,
    - Some applications can use both TCP and UDP.

# Common applications and their destination protocols
    # TCP
        - FTP (21)
        - SSH (22)
        - TELNET (23)
        - HTTP (80)
        - HTTPS (443)
    # UDP
        - TFTP (69)
        - SNMP (161)
    # TCP & UDP 
        - DNS (53)

# Layer 3 - The Network Layer
    - The Network layer is responsible for routing packets to their destination and for quality of service.
    - IP (Internet Protocol) is the best known layer 3 protocol.
    - It is a connectionless protocol with no acknowledgments at Layer 3.
    - Other Layer 3 protocols include ICMP (Internet Control Message Protocol) and IPSec.

# IP Addressing
    - IP Addressing is a logical addressing scheme which is implemented at Layer 3
    - The Network designer uses IP addressing to partition the overall network into smaller 'subnets'.
    - This improves performance and security and makes troubleshooting easier.
    - Layer 2 MAC address use one big flat addressing scheme. There is no logical separation between networks at Layer 2, it is done at Layer 3.

## IPv4 Header Format  

    The IPv4 header contains fields used for addressing, routing, and delivering packets.  


### Field Explanations (Brief)  
    - **Version (4 bits)** → IP version (always `4` for IPv4).  
    - **Header Length (IHL, 4 bits)** → Length of the IPv4 header in 32-bit words.  
    - **Type of Service (TOS, 8 bits)** → Originally for service priority; now often split into **DSCP** (QoS) and **ECN** (congestion control).  
    - **Total Length (16 bits)** → Entire packet size in bytes (header + data).  
    - **Identification (16 bits)** → Unique value for fragment reassembly.  
    - **Flags (3 bits)** → Control fragmentation (e.g., DF = Don’t Fragment, MF = More Fragments).  
    - **Fragment Offset (13 bits)** → Position of this fragment in the original packet.  
    - **Time to Live (TTL, 8 bits)** → Decremented by each router hop; prevents looping.  
    - **Protocol (8 bits)** → Identifies the encapsulated protocol (e.g., 1 = ICMP, 6 = TCP, 17 = UDP).  
    - **Header Checksum (16 bits)** → Error-checking for the IPv4 header.  
    - **Source Address (32 bits)** → IPv4 address of the sender.  
    - **Destination Address (32 bits)** → IPv4 address of the receiver.  
    - **Options (variable, rarely used)** → Extra control features.  
    - **Data (Payload)** → Encapsulated upper-layer data (TCP, UDP, ICMP, etc.).  

    ---

### Unicast, Broadcaast and Multicast traffic
    - There are 3 main IP traffic types: unicast, broadcast and multicast.
    - Unicast traffic is to a single destination host.
    - Broadcaast traffic is to all hosts on the subnet.
    - Multicast traaffic is to multiple interested hosts.

ROUTERS DO NOT FORWARD BROADCAST TRAFFIC  

### Subnet Size

The number of hosts available in a subnet depends on how many bits are allocated to the **host portion** of the address.  
- The **more host bits**, the **more available IP addresses**.  
- The **fewer host bits**, the **fewer available IP addresses**.

### Examples
- **Subnet Mask: /8**  
  - Network portion = 8 bits  
  - Host portion = 24 bits  
  - Number of host addresses = `2^24 - 2 = 16,777,214`  
  - (Subtract 2 for network + broadcast)

- **Subnet Mask: /24**  
  - Network portion = 24 bits  
  - Host portion = 8 bits  
  - Number of host addresses = `2^8 - 2 = 254`

### General Formula
\[
\text{Usable Hosts} = 2^{\text{host bits}} - 2
\]

The **`-2`** accounts for:  
1. **Network Address** (all host bits = 0)  
2. **Broadcast Address** (all host bits = 1)  

## Class A IPv4 Addresses  

The IPv4 address space was historically divided into **classes** (Class A, B, C, D, and E). While classful addressing is largely obsolete and replaced by **CIDR (Classless Inter-Domain Routing)**, it’s still useful for foundational understanding.  

### Characteristics of Class A
    - **First bit**: Always `0`  
    - **Default subnet mask**: `/8` (255.0.0.0)  
    - **Network range**: `1.0.0.0` to `126.0.0.0` (/8 networks)  
    - **Number of possible Class A networks**: 126  
    - **Hosts per network**: `2^24 - 2 = 16,777,214`  
    - `-2` accounts for the **network** and **broadcast** addresses  

### Notes
- Designed for **very large organizations** needing millions of host addresses.  
- Address `127.x.x.x` is reserved for **loopback testing**, not for host addressing.  

### Quick Reference
| Property              | Value                                  |
|-----------------------|----------------------------------------|
| First Octet Range     | 1 – 126                                |
| Default Subnet Mask   | 255.0.0.0 (/8)                         |
| Number of Networks    | 126                                    |
| Hosts per Network     | 16,777,214                             |
| Special Use           | 127.0.0.0/8 reserved for loopback      |
    
## Reserved Class A Addresses  

Certain ranges within the **Class A space** are reserved and cannot be assigned to hosts.  

### 0.0.0.0/8 — "This Network"  
- Reserved to represent **“this network”** in routing and configuration.  
- Range: `0.0.0.1` to `0.255.255.255` are not valid for assignment to hosts.  
- `0.0.0.0` in routing tables represent the **default route**.  

### 127.0.0.0/8 — Loopback  
- Reserved for **loopback addresses** used to test the local computer’s TCP/IP stack.  
- Range: `127.0.0.0` to `127.255.255.255`  
- Commonly used address: `127.0.0.1` (local host / “localhost”).  
- Not valid for assignment to physical network hosts.  

### Key Point  
These reservations remove **33,554,432 addresses** from the usable global IPv4 address pool.  

### Class B IP Addresses
    = Class B addresses are assigned to medium-sized to large-sized networks.
    - The two high-order bits in a class B address are always set to binary 10.
    - The default subnet mask is /16.
    - Valid network addresses range from 128.0.0.0 to 191.255.0.0/16
    - This allows for 16,384 neworks and 65534 hosts per network.

### Class C IP Addresses
    - Class C addresses are used for small networks
    - The three high-order bits in a class C address are always set to binary 110.
    - The defailt subnet mask is /24.
    - Valid network addresses range from 192.0.0.0 to 223.255.255.0/24/
    - This allows for 2097152 networks and 254 hosts per network.
    
### Note on Private Addresses
    - There is a range of reserved Private Addresses in each class.
    - These are valid to be assigned to hosts, but they are not routable on the public internet.
    - They were originally designed for hosts in a closed private network with no Internet connectivity.
    - CLASS A: 10.0.0.0 TO 10.255.255.255
    - CLASS B: 172.16.0.0 TO 172.31.255.255
    - CLASS C: 192.168.0.0 TO 192.168.255.255

### CLASS D IP Address
    - Class D addresses are reserved for IP multicast addresses.
    - The four high-order bits in a class D address are always set to binary 1110
    - These addresses are not allocated to hosts, and there is no default subnet mask
    - Valid addresses range from 224.0.0.0 to 239.255.255.255
### CLASS E IP Address
    - Class E addresses are 'experimental and reserved for future use'
    - The high-order bits in a class E address are set to 1111
    - These addresses are not allocated to hosts, and there is no default subnet mask
    - Addresses range from 240.0.0.0 to 255.255.255.255
    - 255.255.255.255 is the broadcast address for 'this network'

### IP Address Class Summary
    - CLASS A | 1 - 126 | /8 | 255.0.0.0
    - CLASS B | 128 - 191 | /16 | 255.255.0.0
    - CLASS C | 192 - 223 | /24 | 255.255.255.0
    - CLASS D | 224 - 239
    - CLASS E | 240 - 255

### OSI Layer 2
    - Frames are encoded and decoded into bits at Layer 2.
    - Error detection and correction for the physical layer can be provided here.
    - Ethernet is the Layer 2 medium used on Local Area Networks.

### The Ethernet Header 
    - 
### Field Explanations (Brief)  
    - **Preamble (8 bytes)** → A sequence of alternating `1`s and `0`s used by NICs to **synchronise clocking** before frame transmission.  
    - **Destination MAC Address (6 bytes)** → Layer 2 address of the intended receiver.  
    - **Source MAC Address (6 bytes)** → Layer 2 address of the sender.  
    - **EtherType (2 bytes)** → Identifies the payload (e.g., `0x0800` = IPv4, `0x86DD` = IPv6, `0x0806` = ARP).  
    - **Payload(DATA) (46–1500 bytes)** → Encapsulated upper-layer data. If less than 46 bytes, padding is added.  
    - **FCS (Frame Check Sequence, 32 bits)** → CRC value used to detect transmission errors.  

---

### The Media Access Control MAC Address
    - Ethernet uses a 48-bit hexadecimal MAC Address
    - The first 24 bits is the OUI (Organizationally Unique Identifier), which uniquely identifies the manufacturer of the Ethernet port. OUI is assigned by the IEEE.
    - The last 24 bits is vendor assigned.
    - The burned in MAC address on every NIC port in the world is globally unique.
    - Example - 00:50:56:C0:00:08

